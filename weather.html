<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agri-Ved - Weather</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="font-sans text-gray-900 bg-gray-50">

  <!-- Navbar -->
  <header class="fixed top-0 left-0 w-full z-50 shadow-md bg-gradient-to-r from-green-100 to-yellow-100">
    <nav class="flex items-center justify-between px-8 py-4">
      <!-- Logo -->
      <div class="flex items-center">
        <img src="ChatGPT_Image_Sep_22__2025__05_17_37_PM-removebg-preview.png" alt="logo" class="w-12 h-12 rounded-full">
      </div>

      <!-- Links -->
      <ul class="hidden md:flex gap-10 text-lg font-medium ml-12">
        <li><a href="index.html" class="hover:text-yellow-600 lang" data-key="home">Home</a></li>
        <li><a href="chatbot2.htm" class="hover:text-yellow-600 lang" data-key="chatbot">Chatbot</a></li>
        <li><a href="forecast.html" class="hover:text-yellow-600 lang" data-key="weather">Weather Report</a></li>
        <li><a href="#" class="hover:text-yellow-600 lang" data-key="market">Market Price</a></li>
        <li><a href="#services" class="hover:text-yellow-600 lang" data-key="services">Services</a></li>
        <li><a href="#contact" class="hover:text-yellow-600 lang" data-key="contact">Contact Us</a></li>
      </ul>

      <!-- Language Switcher -->
      <div class="relative">
        <select id="langSwitcher"
          class="px-2 py-1 rounded-md bg-green-100 border border-green-300 text-green-800 text-sm font-medium">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
          <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
        </select>
      </div>
    </nav>
  </header>

  <!-- Forecast Section -->
  <main class="pt-10 px-6">
    <h2 class="text-2xl font-bold text-center mb-6 mt-14">üå¶Ô∏è 7-Day Weather Forecast</h2>
    <div class="max-w-4xl mx-auto bg-white p-4 shadow-lg rounded-lg">
      <canvas id="weatherChart" class="w-full"></canvas>
    </div>
  </main>

  <script>
    // üîë Your OpenWeatherMap API Key
    const API_KEY = "a701e399628eb468b780be2d8f07cb8b";

    // Get lat/lon from signup (stored in localStorage)
    const LAT = localStorage.getItem("latitude");
    const LON = localStorage.getItem("longitude");

    async function fetchWeather() {
      if (!LAT || !LON) {
        alert("‚ö†Ô∏è No location data found! Please sign up again.");
        return;
      }

      try {
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/onecall?lat=${LAT}&lon=${LON}&exclude=current,minutely,hourly,alerts&units=metric&appid=${API_KEY}`
        );
        const data = await response.json();

        // Extract next 7 days forecast
        const labels = data.daily.slice(0, 7).map((d) =>
          new Date(d.dt * 1000).toLocaleDateString("en-US", { weekday: "short" })
        );

        const tempData = data.daily.slice(0, 7).map((d) => d.temp.day);
        const rainData = data.daily.slice(0, 7).map((d) => d.rain || 0);
        const humidityData = data.daily.slice(0, 7).map((d) => d.humidity);

        renderChart(labels, tempData, rainData, humidityData);
      } catch (err) {
        console.error("Weather fetch failed:", err);
        alert("‚ö†Ô∏è Unable to fetch weather data. Check API key or location.");
      }
    }

    function renderChart(labels, tempData, rainData, humidityData) {
      const ctx = document.getElementById("weatherChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Rainfall (mm)",
              data: rainData,
              type: "bar",
              backgroundColor: "rgba(54, 162, 235, 0.6)",
              borderColor: "rgba(54, 162, 235, 1)",
              borderWidth: 1,
              yAxisID: "y-rain"
            },
            {
              label: "Temperature (¬∞C)",
              data: tempData,
              type: "line",
              borderColor: "rgba(255, 99, 132, 1)",
              backgroundColor: "rgba(255, 99, 132, 0.2)",
              tension: 0.4,
              fill: false,
              yAxisID: "y-temp"
            },
            {
              label: "Humidity (%)",
              data: humidityData,
              type: "line",
              borderColor: "rgba(75, 192, 192, 1)",
              backgroundColor: "rgba(75, 192, 192, 0.2)",
              tension: 0.4,
              fill: false,
              yAxisID: "y-humidity"
            }
          ]
        },
        options: {
          responsive: true,
          interaction: { mode: "index", intersect: false },
          stacked: false,
          plugins: {
            legend: { position: "top" },
            tooltip: { mode: "nearest", intersect: false },
          },
          scales: {
            "y-temp": {
              type: "linear",
              position: "left",
              title: { display: true, text: "Temperature (¬∞C)" },
            },
            "y-rain": {
              type: "linear",
              position: "right",
              title: { display: true, text: "Rainfall (mm)" },
              grid: { drawOnChartArea: false }
            },
            "y-humidity": {
              type: "linear",
              position: "right",
              title: { display: true, text: "Humidity (%)" },
              grid: { drawOnChartArea: false }
            }
          }
        }
      });
    }

    // Load on page start
    fetchWeather();
  </script>
</body>
</html>
